<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scSpatialSIM">
<title>Using with spatialTIME • scSpatialSIM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using with spatialTIME">
<meta property="og:description" content="scSpatialSIM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scSpatialSIM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_Introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/a02_Using_with_spatialTIME.html">Using with spatialTIME</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/FridleyLab/scSpatialSIM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using with spatialTIME</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FridleyLab/scSpatialSIM/blob/HEAD/vignettes/a02_Using_with_spatialTIME.Rmd" class="external-link"><code>vignettes/a02_Using_with_spatialTIME.Rmd</code></a></small>
      <div class="d-none name"><code>a02_Using_with_spatialTIME.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>More than likely, you are going to want to use another package to
analyze the simulated data produced by <a href="https://github.com/FridleyLab/scSpatialSIM" class="external-link">scSpatialSIM</a>.
Here, we will show how the output from <a href="https://github.com/FridleyLab/scSpatialSIM" class="external-link">scSpatialSIM</a> works
seemlessly with the spatial analysis package,
<a href="https://github.com/FridleyLab/spatialTIME" class="external-link">spatialTIME</a></p>
<div class="section level3">
<h3 id="simulating-data">Simulating Data<a class="anchor" aria-label="anchor" href="#simulating-data"></a>
</h3>
<p>First thing we need to do is simulate data. The
<code>vignette("Introduction)</code> showed us how we can do this in a
univariate way where only a single cells positivity was simulated and
bivaraiate way where we get positivity for multiple cell types. We can
use this data with <a href="https://github.com/FridleyLab/spatialTIME" class="external-link">spatialTIME</a> to derive spatial
statistics like Ripley’s <em>K</em>. See the spatialTIME package for
more information about everything the package can do.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/FridleyLab/scSpatialSIM" class="external-link">scSpatialSIM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; scSpatialSIM Version:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB;">0.1.3.3</span></span></span>
<span><span class="co">#&gt;             _____             _   _       _  _____ _____ __  __</span></span>
<span><span class="co">#&gt;            / ____|           | | (_)     | |/ ____|_   _|  \/  |</span></span>
<span><span class="co">#&gt;   ___  ___| (___  _ __   __ _| |_ _  __ _| | (___   | | | \  / |</span></span>
<span><span class="co">#&gt;  / __|/ __|\___ \| '_ \ / _` | __| |/ _` | |\___ \  | | | |\/| |</span></span>
<span><span class="co">#&gt;  \__ \ (__ ____) | |_) | (_| | |_| | (_| | |____) |_| |_| |  | |</span></span>
<span><span class="co">#&gt;  |___/\___|_____/| .__/ \__,_|\__|_|\__,_|_|_____/|_____|_|  |_|</span></span>
<span><span class="co">#&gt;                  | |</span></span>
<span><span class="co">#&gt;                  |_|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Fridley Lab <span style="color: #BBBBBB;">Enjoy</span></span></span></code></pre></div>
<p>In this vignette, we will stick with a single cell type and look at
univariate clustering with and without holes to display the caution that
should be taken when using the observed Ripley’s <em>K</em> values.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="co">#create the new object</span></span>
<span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSimulationObject.html">CreateSimulationObject</a></span><span class="op">(</span>sims <span class="op">=</span> <span class="fl">5</span>, cell_types <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co">#produce the point pattern</span></span>
<span>    <span class="fu"><a href="../reference/GenerateSpatialPattern.html">GenerateSpatialPattern</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; No `window` specified - defaulting to x (0, 10); y (0, 10)</span></span>
<span>    <span class="co">#make tissues</span></span>
<span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/GenerateTissue.html">GenerateTissue</a></span><span class="op">(</span><span class="va">sim_object</span>, density_heatmap <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co">#create holes</span></span>
<span>    <span class="fu"><a href="../reference/GenerateHoles.html">GenerateHoles</a></span><span class="op">(</span>hole_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span>, density_heatmap <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="co">#Create positive/negative cells</span></span>
<span>    <span class="fu"><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity</a></span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing tissue probability</span></span>
<span><span class="co">#&gt; Computing hole probability</span></span>
<span><span class="co">#&gt; Computing probability for Cell 1</span></span></code></pre></div>
<p>With the simulation object filled in with a single cell type, it can
be split into a spatial list as well as a summary using
<code><a href="../reference/CreateSpatialList.html">CreateSpatialList()</a></code> and
<code><a href="../reference/SummariseSpatial.html">SummariseSpatial()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#creating the spatial list</span></span>
<span><span class="va">spatial_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSpatialList.html">CreateSpatialList</a></span><span class="op">(</span><span class="va">sim_object</span>, single_df <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co">#summarise the spatial list</span></span>
<span><span class="va">summary_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/SummariseSpatial.html">SummariseSpatial</a></span><span class="op">(</span><span class="va">spatial_list</span>, markers <span class="op">=</span> <span class="st">"Cell 1 Assignment"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   `Sample Tag`   `Total Cells` `Cell 1 Assignment` `% Cell 1 Assignment`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Spatial Data 1          <span style="text-decoration: underline;">2</span>495                 673                  27.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Spatial Data 2          <span style="text-decoration: underline;">2</span>450                 475                  19.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Spatial Data 3          <span style="text-decoration: underline;">2</span>500                 582                  23.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Spatial Data 4          <span style="text-decoration: underline;">2</span>514                 525                  20.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Spatial Data 5          <span style="text-decoration: underline;">2</span>486                 450                  18.1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-with-spatialtime">Using with <code>spatialTIME</code><a class="anchor" aria-label="anchor" href="#using-with-spatialtime"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/FridleyLab/spatialTIME" class="external-link">spatialTIME</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; spatialTIME version:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB;">1.3.4.2</span></span></span>
<span><span class="co">#&gt; If using for publication, please cite our manuscript:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB;">https://doi.org/10.1093/bioinformatics/btab757</span></span></span></code></pre></div>
<p>The <a href="https://github.com/FridleyLab/spatialTIME" class="external-link">spatialTIME</a> package requires the input of 3
things. 1) spatial data frames in list format, 2) a summary of those
spatial data frames, and 3) a clinical data frames The summary data
frame acts as a linker between the spatial data frame IDs and the
entries in the clinical data frame. Our spatial data frames need 1 more
column: their name. This is pretty easy to do.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#loop over all spatial data frames and add their names</span></span>
<span><span class="va">sf_names</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spatial_list</span><span class="op">)</span></span>
<span><span class="va">spatial_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">sf_names</span>, <span class="va">sf_names</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nam</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">spatial_list</span><span class="op">[[</span><span class="va">nam</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Sample Tag` <span class="op">=</span> <span class="va">nam</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Our summary data frame already contains the names of the spatial data
frames but needs a patient ID added.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_df</span><span class="op">$</span><span class="va">`Patient ID`</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span></code></pre></div>
<p>The number 3 data we needed was the clinical data frame. For the sake
of this example we will just make a single columned data frame with 1
through 5 to match the “Patient ID” in the summary data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clinical</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>`Patient ID` <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, check.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>These column names will be used when creating the <code>mIF</code>
object along with the 3 data objects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mif</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/spatialTIME/man/create_mif.html" class="external-link">create_mif</a></span><span class="op">(</span>clinical_data <span class="op">=</span> <span class="va">clinical</span>,</span>
<span>                 sample_data <span class="op">=</span> <span class="va">summary_df</span>,</span>
<span>                 spatial_list <span class="op">=</span> <span class="va">spatial_list</span>,</span>
<span>                 patient_id <span class="op">=</span> <span class="st">"Patient ID"</span>,</span>
<span>                 sample_id <span class="op">=</span> <span class="st">"Sample Tag"</span><span class="op">)</span></span>
<span><span class="va">mif</span></span>
<span><span class="co">#&gt; <span style="color: #00D7FF;">5</span> patients spanning <span style="color: #00D7FF;">5</span> samples and <span style="color: #00D7FF;">5</span> spatial data frames were found</span></span></code></pre></div>
<p>Since our window is from 0 to 10 (10 units), we should keep our
search radius max less than 5. Lets do Univariate Ripley’s K from 0 to 3
units and visualize the results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mif</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/spatialTIME/man/ripleys_k.html" class="external-link">ripleys_k</a></span><span class="op">(</span>mif <span class="op">=</span> <span class="va">mif</span>, mnames <span class="op">=</span> <span class="st">"Cell 1 Assignment"</span>, r_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                permute <span class="op">=</span> <span class="cn">FALSE</span>, edge_correction <span class="op">=</span> <span class="st">"translation"</span>, workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                xloc <span class="op">=</span> <span class="st">"x"</span>, yloc <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">mif</span><span class="op">$</span><span class="va">derived</span><span class="op">$</span><span class="va">univariate_Count</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">r</span>, y <span class="op">=</span> <span class="va">`Degree of Clustering Exact`</span>, color <span class="op">=</span> <span class="va">`Sample Tag`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Univariate Clustering - Simulation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a02_Using_with_spatialTIME_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Up until now, we have been using the all simulated cells. We can
filter the spatial_list down to create another mIF object that doesn’t
have the cells belonging to the class of “hole”
(<code>Hole Assignment</code> == “Keep”). For now, sub-setting to only
Tissue 1 or Tissue 2 will be left alone. Let’s create this mIF and run
Ripley’s K on it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mif_holes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/spatialTIME/man/create_mif.html" class="external-link">create_mif</a></span><span class="op">(</span>clinical_data <span class="op">=</span> <span class="va">clinical</span>,</span>
<span>                 sample_data <span class="op">=</span> <span class="va">summary_df</span>,</span>
<span>                 spatial_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spatial_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">spat</span><span class="op">)</span><span class="op">{</span></span>
<span>                   <span class="va">spat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`Hole Assignment`</span> <span class="op">==</span> <span class="st">"Keep"</span><span class="op">)</span></span>
<span>                 <span class="op">}</span><span class="op">)</span>,</span>
<span>                 patient_id <span class="op">=</span> <span class="st">"Patient ID"</span>,</span>
<span>                 sample_id <span class="op">=</span> <span class="st">"Sample Tag"</span><span class="op">)</span></span>
<span><span class="va">mif_holes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/spatialTIME/man/ripleys_k.html" class="external-link">ripleys_k</a></span><span class="op">(</span>mif <span class="op">=</span> <span class="va">mif_holes</span>, mnames <span class="op">=</span> <span class="st">"Cell 1 Assignment"</span>, r_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                permute <span class="op">=</span> <span class="cn">FALSE</span>, edge_correction <span class="op">=</span> <span class="st">"translation"</span>, workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                xloc <span class="op">=</span> <span class="st">"x"</span>, yloc <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(r)`</span></span></code></pre></div>
<p>To see the importance of using the exact CSR approach (or
permutation) when there are holes on samples, first look at the spatial
plots to see how much the holes are impacting the distribution of the
points.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mif_holes</span><span class="op">$</span><span class="va">spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">`Cell 1 Assignment`</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">`Sample Tag`</span><span class="op">)</span></span></code></pre></div>
<p><img src="a02_Using_with_spatialTIME_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>The regions with holes are rather small so wouldn’t</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span>, <span class="va">mif_holes</span><span class="op">$</span><span class="va">derived</span><span class="op">$</span><span class="va">univariate_Count</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Exact-Theo` <span class="op">=</span> <span class="va">`Exact CSR`</span> <span class="op">-</span> <span class="va">`Theoretical CSR`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`Exact-Theo`</span>, fill <span class="op">=</span> <span class="va">`Sample Tag`</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, adjust <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="a02_Using_with_spatialTIME_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>This clearly shows that the exact <em>typically</em> has larger
values than those of the theoretical (positive values). These can be
visualized by calculating the frequency of <em>r</em>s that have an
exact CSR measurement greater than the theoretical CSR estimate,
indicating the the theoretical is underestimating the CSR of the
cores.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>`Exact-Theo` <span class="op">=</span> <span class="va">`Exact CSR`</span> <span class="op">-</span> <span class="va">`Theoretical CSR`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`Sample Tag`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">`Exact-Theo`</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`Sample Tag`</span>, <span class="va">r</span>, <span class="va">`Exact-Theo`</span>, <span class="va">prop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>`Total Fraction` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">#&gt;   `Sample Tag`   `Total Fraction`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Spatial Data 1            0.355</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Spatial Data 2            0.645</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Spatial Data 3            0.968</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Spatial Data 4            0.968</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Spatial Data 5            0.968</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Soupir, Christopher Wilson, Jordan Creed, Julia Wrobel, Oscar Ospina, Brooke Fridley, Fridley Lab.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
