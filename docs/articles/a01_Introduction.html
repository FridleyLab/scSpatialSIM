<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scSpatialSIM">
<title>Introduction • scSpatialSIM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="scSpatialSIM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scSpatialSIM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a01_Introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/a02_Using_with%20spatialTIME.html">Using with spatialTIME</a>
    <a class="dropdown-item" href="../articles/a03_CellAttributes.html">Adding Cell Attributes</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/FridleyLab/mIFsim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FridleyLab/mIFsim/blob/HEAD/vignettes/a01_Introduction.Rmd" class="external-link"><code>vignettes/a01_Introduction.Rmd</code></a></small>
      <div class="d-none name"><code>a01_Introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="spatial-point-patterns">Spatial Point Patterns<a class="anchor" aria-label="anchor" href="#spatial-point-patterns"></a>
</h3>
<p>Spatial point patterns are the realization of spatial point process
models. They are points that represent some feature, in our case cells
but in ecological studies can be trees or plants, in space. Our space is
2-dimensional with an x and y axis with arbitrary units. Each point in
the spatial point pattern can have marks - characteristics that describe
information about the point. These marks can be things like whether it’s
positive or negative for a specific phenotype or tissue, perhaps the
size of the cell, or even the intensity of a fluorophore on the cells
surface. The spatial point pattern can provide us with a great deal of
information about a pathology when looking at cell spatial
contexture.</p>
<p>In order to understand the cell contexture of a pathology,
researchers can employ different spatial statistic methods that describe
some feature of the spatial point pattern. A simple descriptive
statistic of a spatial point pattern is <strong><em>lambda</em></strong>
which describes the <em>intensity</em>. A large <em>lambda</em> means
that there are a large number of points in a given boundary, and a small
<em>lambda</em> means for the same boundary area there are less points.
Another summary statistic is Ripley’s <em>K(r)</em> which describes how
many other points of interest are within <em>r</em> of an anchor cell.
This measurement can then be compared to different things like a
complete spatial randomness (CSR) measurement to estimate how far the
observed cell contexture deviates from random cell locations in the
sample. In addition to Ripley’s <em>K(r)</em>, there are several other
methods such as a nearest neighbor <em>G(r)</em> function and an
interaction variable developed by <a href="https://aacrjournals.org/mcr/article/19/12/1973/675069/The-Spatial-Context-of-Tumor-Infiltrating-Immune" class="external-link">Steinhart
et. al</a>.</p>
</div>
<div class="section level3">
<h3 id="simulating">Simulating<a class="anchor" aria-label="anchor" href="#simulating"></a>
</h3>
<p>In order to compare metrics for describing point patterns, we have
developed this simulation package: <a href="https://github.com/FridleyLab/mIFsim" class="external-link">scSpatialSIM</a>. The main
basis of the package is using Gaussian kernels to assign different
characteristics to the underlying spatial point pattern. A Gaussian
kernel is described in 3 different ways in our package: kernel’s center,
standard deviation in the x-direction and standard deviation in the
y-direction. There are <em>k</em> kernel means or centers in the point
pattern which each has these descriptors. With the kernels for a spatial
point pattern described and locations of points, the kernels can be used
to give a probability to the points - closer to the center <em>k</em>
the greater the probability for what the kernel is describing and
farther away from any <em>k</em> center the lower the probability.</p>
<p>Having probabilities that range from 0 to 1 assumes kernel centers
are ‘hot’ for the tissue/cell phenotype/hole, but in reality this is not
always the case. Due to the inherent noise that we see with tissues at
the cell level, we have provided the ability to limit the kernel center
probability and increase the background probability. In addition to this
making the simulations more realistic, this also allows for abundance
control for cell phenotypes (lower max probability lower abundance).</p>
</div>
</div>
<div class="section level2">
<h2 id="using-scspatialsim">Using <code>scSpatialSIM</code><a class="anchor" aria-label="anchor" href="#using-scspatialsim"></a>
</h2>
<p>The process of simulating cell type data was streamlined in a similar
way to what one thinks of when thinking of real data. First, an S4
<code>SpatSimObj</code> object is initialized with all the slots that
are needed to proceed through the whole simulation process. Slots inside
are for kernels that describe tissue, holes, cell phenotypes, the
simulation window, and a tabular format of them. With the
<code>SpatialSimulationObject()</code> ready, the point patterns can be
simulated (these point patterns act as a ‘master’ for the next parts).
The point pattern as it is is similar to an extracellular matrix that
just has places for cells to go but no identity for the cells. Thinking
more broadly, we need to create tissue regions for our images which is
designated as either tissue 1 and tissue 2 (can be interpreted as tumor
or stroma). Separately, cell phenotypes can be assigned to each cell.
This is all done with separate kernels for each step which allows for
high customization and fine tuning of the simulated samples and the
spatial contexture. If parameters are changed from the initialized
values, then they will be stored in the object so in the future they can
be referred to again.</p>
<p>Spatial statistics are usually interested in the amount of clustering
points with a single mark type have. For example, it has been shown that
<a href="https://doi.org/10.1371/journal.pcbi.1009900" class="external-link">high abundance
but low clustering of cytotoxic T cells is associated with better
overall survival than missing cytotoxic T cells in high grade serous
ovarian cancer tumors</a>. There are also instances that colocalization
of 2 difference cell types might be of interest such as T cell and B
cells in tumors. With <a href="https://github.com/FridleyLab/mIFsim" class="external-link">scSpatialSIM</a>, we provide methods to
perform both of these spatial point patterns. Input parameters dictate
the layout of a first cell type. In the case where more than one cell
type is wanted, a shift value is taken which uses the same kernel as the
first cell type (<code>shift = 0</code>) for strong colocalization or
moved the first cell types’ kernel towards Dirichlet vertices
(<code>shift = 1</code>) for segregation.</p>
<div class="section level3">
<h3 id="univariate-simulation">Univariate Simulation<a class="anchor" aria-label="anchor" href="#univariate-simulation"></a>
</h3>
<p>In order to get started simulating cell type samples, we need to
import the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/FridleyLab/mIFsim" class="external-link">scSpatialSIM</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; scSpatialSIM Version:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBBBB;">0.0.0.9000</span></span></span>
<span><span class="co">#&gt;             _____             _   _       _  _____ _____ __  __</span></span>
<span><span class="co">#&gt;            / ____|           | | (_)     | |/ ____|_   _|  \/  |</span></span>
<span><span class="co">#&gt;   ___  ___| (___  _ __   __ _| |_ _  __ _| | (___   | | | \  / |</span></span>
<span><span class="co">#&gt;  / __|/ __|\___ \| '_ \ / _` | __| |/ _` | |\___ \  | | | |\/| |</span></span>
<span><span class="co">#&gt;  \__ \ (__ ____) | |_) | (_| | |_| | (_| | |____) |_| |_| |  | |</span></span>
<span><span class="co">#&gt;  |___/\___|_____/| .__/ \__,_|\__|_|\__,_|_|_____/|_____|_|  |_|</span></span>
<span><span class="co">#&gt;                  | |</span></span>
<span><span class="co">#&gt;                  |_|</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Fridley Lab <span style="color: #BBBBBB;">Enjoy</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span> <span class="co">#reproducibility</span></span></code></pre></div>
<p>To create a simulation object, we can call
<code><a href="../reference/CreateSimulationObject.html">CreateSimulationObject()</a></code>, which takes in 3 arguments that
will initialize the object for all downstream functions:</p>
<ol style="list-style-type: decimal">
<li>
<code>window</code> - a <code>spatstat</code> owin object which is
the boundary for which to simulate our points. The window acts as a mask
so the functions know where to simulate points later on.</li>
<li>
<code>sims</code> - an integer value that is the number of samples
that is wanting to be simulated</li>
<li>
<code>cell_types</code> - this is the number of different phenotypes
to simulate, here we are only going to do a single cell type</li>
</ol>
<p>If a window isn’t specified a built in 10x10 unit window will be
used. To make a custom window, we an use
<code><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">spatstat.geom::owin</a></code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_window</span> <span class="op">=</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">owin</a></span><span class="op">(</span>xrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, yrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s create our simulation object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSimulationObject.html">CreateSimulationObject</a></span><span class="op">(</span>sims <span class="op">=</span> <span class="fl">9</span>, cell_types <span class="op">=</span> <span class="fl">1</span>, window <span class="op">=</span> <span class="va">custom_window</span><span class="op">)</span></span></code></pre></div>
<p>The simulation object has some attributes that are gradually filled
in as we progress. Using the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method, we can see
what our simulation object has inside and what we need to do next. Here,
we have 9 simulations with the default window and are wanting to perform
this for a single cell type. This method is really useful when fine
tuning parameters to get the desired output because it shows you exactly
what has already been done when loading in the base object from an RDS
file.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Simulation object for 9 simulated images. Currently, there are:</span></span>
<span><span class="co">#&gt;  Window: x (0,10); y (0,10)</span></span>
<span><span class="co">#&gt;  0 spatial point patterns</span></span>
<span><span class="co">#&gt;  0 tissue kernels</span></span>
<span><span class="co">#&gt;  0 hole kernels</span></span>
<span><span class="co">#&gt;  0 cell kernels for 1 cell types</span></span></code></pre></div>
<p>Now that we have our simulation object and parameters set within, we
need to create the point pattern. The
<code><a href="../reference/GenerateSpatialPattern.html">GenerateSpatialPattern()</a></code> function takes in the spatial
simulation object and a <code>lambda</code>, or intensity of the point
pattern. <strong>NOTE: with large windows and large lambdas, the size of
the spatial simulation object can grow fast so be mindful.</strong> Any
other parameters that could be passed to
<code><a href="https://rdrr.io/pkg/spatstat.random/man/rpoispp.html" class="external-link">spatstat.random::rpoispp</a></code> can then be passed to
<code><a href="../reference/GenerateSpatialPattern.html">GenerateSpatialPattern()</a></code> at the end. Again, we can check
how we are filling in our slots with <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and even see
how our new process looks like with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/GenerateSpatialPattern.html">GenerateSpatialPattern</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Simulation object for 9 simulated images. Currently, there are:</span></span>
<span><span class="co">#&gt;  Window: x (0,10); y (0,10)</span></span>
<span><span class="co">#&gt;  9 spatial point patterns</span></span>
<span><span class="co">#&gt;  0 tissue kernels</span></span>
<span><span class="co">#&gt;  0 hole kernels</span></span>
<span><span class="co">#&gt;  0 cell kernels for 1 cell types</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_object</span>, what <span class="op">=</span> <span class="st">"Patterns"</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="co">#print only first point pattern</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Next we will generate some regions of different tissue. For the
purpose here, tissue 1 will be tumor and tissue 2 will be stroma. There
are some parameters that are initialized when building the spatial
simulation that tells downstream functions how to simulate things on a
Gaussian kernel - <code><a href="../reference/GenerateTissue.html">GenerateTissue()</a></code> is one of those. If
there is nothing supplied to the function when calling, it will default
to these values. Alternatively, can specify them in the function call.
These include regions within your window that you would like tissue
regions to be simulated, the number of regions, the standard deviation
range for how the probability falls off around the region centers, etc.
Something here is whether the ending kernel should be converted to a
heatmap and at what resolution. <strong>NOTE: the smaller the
<code>step_size</code> used for the heatmap the longer it takes to run
so be mindful.</strong></p>
<p>After simulating the tissues we can look at the summary of the
spatial simulation object to see the newly filled slot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/GenerateTissue.html">GenerateTissue</a></span><span class="op">(</span><span class="va">sim_object</span>, density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing density heatmap</span></span>
<span><span class="co">#&gt; Computing tissue probability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Simulation object for 9 simulated images. Currently, there are:</span></span>
<span><span class="co">#&gt;  Window: x (0,10); y (0,10)</span></span>
<span><span class="co">#&gt;  9 spatial point patterns</span></span>
<span><span class="co">#&gt;  9 tissue kernels</span></span>
<span><span class="co">#&gt;  0 hole kernels</span></span>
<span><span class="co">#&gt;  0 cell kernels for 1 cell types</span></span></code></pre></div>
<p>The tissue kernel slot is now filled the number of kernels matching
number of spatial processes we have. Let’s take a look at the simulated
tissue kernels with <code><a href="../reference/PlotSimulation.html">PlotSimulation()</a></code>. If using negative
ranges in the window, the function will use the overlap between default
<code><a href="../reference/GenerateTissue.html">GenerateTissue()</a></code> range and the window. See documentation
for <code><a href="../reference/GenerateTissue.html">GenerateTissue()</a></code> for more details.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotSimulation.html">PlotSimulation</a></span><span class="op">(</span><span class="va">sim_object</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, what <span class="op">=</span> <span class="st">"tissue heatmap"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-7-1.png" width="864"></p>
<p>The kernels are randomly laid about the simulation region and random
sizes within the constraints of the parameters provided. The number of
tissue regions simulated are fixed by the input <code>k</code> value,
and not sampled from a distribution centered at <code>k</code>. A larger
<code>sdmin</code> and <code>sdmax</code> would increase the sizes of
the tissue regions. See <code><a href="../reference/GenerateTissue.html">GenerateTissue()</a></code> for more
information.</p>
<p>Generating holes can help assess the need for correcting metrics
derived spatial statistics. For example, if there is a pond in the
center of a field, crops are not able to be planted there yet measuring
the amount of field there is just by the outside border will say that
lots of crops should be able to fit. Sometimes, these things need to be
adjusted for such as when you have tissue sections that are being
stained and the second folds over or tears, leaving a large area where
no longer cells are present. Even if not using holes for assessing
metrics, performing them will just create a new column in the spatial
files that can be later ignored. If holes are not needed at all, this
can be skipped.</p>
<p>The parameters that go into <code><a href="../reference/GenerateHoles.html">GenerateHoles()</a></code> is similar
to that of <code><a href="../reference/GenerateTissue.html">GenerateTissue()</a></code> with one addition:
<code>hole_prob</code> or the proportion range of the point patterns
that could become holes. All of these parameters had defaults set when
the spatial simulation object was created, but can be overridden here is
a particular area of the process is wanted to have the holes and not the
rest. The number of holes is random as long as the sum of the area is
within the proportions above.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/GenerateHoles.html">GenerateHoles</a></span><span class="op">(</span><span class="va">sim_object</span>, density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing density heatmap</span></span>
<span><span class="co">#&gt; Computing hole probability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Simulation object for 9 simulated images. Currently, there are:</span></span>
<span><span class="co">#&gt;  Window: x (0,10); y (0,10)</span></span>
<span><span class="co">#&gt;  9 spatial point patterns</span></span>
<span><span class="co">#&gt;  9 tissue kernels</span></span>
<span><span class="co">#&gt;  9 hole kernels</span></span>
<span><span class="co">#&gt;  0 cell kernels for 1 cell types</span></span></code></pre></div>
<p>Let’s see how the kernels for holes look. The center of the holes
have the highest probability of being removed with a Bernoulli
distribution of ‘hole’ or ‘not a hole’.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotSimulation.html">PlotSimulation</a></span><span class="op">(</span><span class="va">sim_object</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">2</span>, what <span class="op">=</span> <span class="st">"hole heatmap"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`1`</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-9-1.png" width="864"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span></code></pre>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-9-2.png" width="864"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"class")</span></span>
<span><span class="co">#&gt; [1] "list"      "ggarrange"</span></span></code></pre>
<p>Next thing for us to do is to simulate the positivity of cells for a
phenotype using <code><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity()</a></code>. Just like holes
and the tissue, there are boundaries which the simulated positive cells
will fall in which are stored in the parameters. This is helpful for
going back and seeing what was done. However here, there are 2 different
parameters that help set the abundance (<code>probs</code>) and, in the
case of multiple cell types, how related those cell types are
(<code>shift</code>).</p>
<p>The <code>probs</code> parameter is used to scale the probabilities
for the cell type where the first number is away from kernel peaks and
the second is the maximum probability for a cell. For higher abundance,
the maximum probability can be set higher and even increase the minimum
probability. An issue with doing this on point patterns that have
multiple cell types is that they are not entirely informed of one
another when assigning cell types. B cells and T cells are distinct
phenotypes and therefore one cell <em>shouldn’t</em> be positive for
both. What we do, is use the probability with the Bernoulli distribution
so there’s a chance a single cell will be positive for 2 cell types,
even if the max probability is 0.1.</p>
<p>For univariate clustering, smaller standard deviations and higher
probability range will increase the amount of clustering. Large standard
deviations and low probabilities will make the clustering metrics low.
For univariate cell simulation, the <code>shift</code> metric does
nothing. The similarity of 2 or more cell types is controlled by the
<code>shift</code> value. A <code>shift = 0</code> will use the same
kernel used for probabilities of Cell Type 1 for the other cell types,
and <code>shift = 1</code> will move Cell Type 1 kernel so that cells
are segregated (with noise) to Dirichlet vertices when 3 or more kernel
centers are used.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_object</span> <span class="op">=</span> <span class="fu"><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity</a></span><span class="op">(</span><span class="va">sim_object</span>, k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                    sdmin <span class="op">=</span> <span class="fl">3</span>, sdmax <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                    density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                                    shift <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing density heatmap for Cell 1</span></span>
<span><span class="co">#&gt; Computing probability for Cell 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_object</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Simulation object for 9 simulated images. Currently, there are:</span></span>
<span><span class="co">#&gt;  Window: x (0,10); y (0,10)</span></span>
<span><span class="co">#&gt;  9 spatial point patterns</span></span>
<span><span class="co">#&gt;  9 tissue kernels</span></span>
<span><span class="co">#&gt;  9 hole kernels</span></span>
<span><span class="co">#&gt;  9 cell kernels for 1 cell types</span></span></code></pre></div>
<p>If we plot the simulation object now specifying we want to see the
whole core, we can see our cells. There are little pockets of positive
cells also with some noise.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/PlotSimulation.html">PlotSimulation</a></span><span class="op">(</span><span class="va">sim_object</span>, which <span class="op">=</span> <span class="fl">1</span>, what <span class="op">=</span> <span class="st">"whole core"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="bivariate-simulation">Bivariate Simulation<a class="anchor" aria-label="anchor" href="#bivariate-simulation"></a>
</h3>
<p>The process for 2 or more cell types is essentially the same as for a
single cell type with the addition of the <code>shift</code> value when
simulating the cell types. Lets create another <code>SpatSimObj</code>
to get to the phenotype simulating step with
<code><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity()</a></code>. A great feature of
<a href="https://github.com/FridleyLab/mIFsim" class="external-link">scSpatialSIM</a> is that it works nicely with
<a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a> and the pipe function to immediately pass output
from one function to the next.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">333</span><span class="op">)</span></span>
<span><span class="co">#create the new object</span></span>
<span><span class="va">bivariate_sim</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSimulationObject.html">CreateSimulationObject</a></span><span class="op">(</span>sims <span class="op">=</span> <span class="fl">5</span>, cell_types <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#produce the point pattern</span></span>
<span>  <span class="fu"><a href="../reference/GenerateSpatialPattern.html">GenerateSpatialPattern</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#make tissues</span></span>
<span>  <span class="fu"><a href="../reference/GenerateTissue.html">GenerateTissue</a></span><span class="op">(</span>density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; No `window` specified - defaulting to x (0, 10); y (0, 10)</span></span>
<span><span class="co">#&gt; Computing density heatmap</span></span>
<span><span class="co">#&gt; Computing tissue probability</span></span></code></pre></div>
<p>As previously mentioned, we can specify a <code>shift</code> values
of 0 to use the same kernel for both cell types which will assign them
in such a way that will be identifiable as colocalized between Cell Type
1 and Cell Type 2. First, the low shift:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bivariate_sim_tmp</span>  <span class="op">=</span> <span class="fu"><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity</a></span><span class="op">(</span><span class="va">bivariate_sim</span>, k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                    sdmin <span class="op">=</span> <span class="fl">3</span>, sdmax <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                    density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                                    shift <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing density heatmap for Cell 1</span></span>
<span><span class="co">#&gt; Computing probability for Cell 1</span></span>
<span><span class="co">#&gt; Copying density heatmap for Cell 2</span></span>
<span><span class="co">#&gt; Computing probability for Cell 2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/PlotSimulation.html">PlotSimulation</a></span><span class="op">(</span><span class="va">bivariate_sim_tmp</span>, which <span class="op">=</span> <span class="fl">1</span>, what <span class="op">=</span> <span class="st">"whole core"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<p>We can see that in locations where Cell Type 1 is, Cell Type 2 is
also present. There are a couple cells that are assigned as positive for
both Cell Type 1 and Cell Type 2 which should be taken into
consideration for next steps. If looking at colocalization of mutually
exclusive cell types, these should be removed.</p>
<p>How does this compare with strong segregation between Cell Type 1 and
Cell Type 2?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bivariate_sim_tmp</span>  <span class="op">=</span> <span class="fu"><a href="../reference/GenerateCellPositivity.html">GenerateCellPositivity</a></span><span class="op">(</span><span class="va">bivariate_sim</span>, k <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                    sdmin <span class="op">=</span> <span class="fl">3</span>, sdmax <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                    density_heatmap <span class="op">=</span> <span class="cn">T</span>, step_size <span class="op">=</span> <span class="fl">0.1</span>, cores <span class="op">=</span> <span class="fl">1</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>                                    shift <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Computing density heatmap for Cell 1</span></span>
<span><span class="co">#&gt; Computing probability for Cell 1</span></span>
<span><span class="co">#&gt; Computing density heatmap for Cell 2</span></span>
<span><span class="co">#&gt; Computing probability for Cell 2</span></span>
<span></span>
<span><span class="fu"><a href="../reference/PlotSimulation.html">PlotSimulation</a></span><span class="op">(</span><span class="va">bivariate_sim_tmp</span>, which <span class="op">=</span> <span class="fl">1</span>, what <span class="op">=</span> <span class="st">"whole core"</span><span class="op">)</span></span></code></pre></div>
<p><img src="a01_Introduction_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<p>In Tissue 2 it’s easier to see regions of only Cell Type 1 and
regions of only Cell Type 2.</p>
</div>
</div>
<div class="section level2">
<h2 id="exporting-data">Exporting Data<a class="anchor" aria-label="anchor" href="#exporting-data"></a>
</h2>
<p>Lastly, the data is likely wanted in tabular format. Since there are
multiple simulated point patterns, the function
<code><a href="../reference/CreateSpatialList.html">CreateSpatialList()</a></code> returns a list of data frames
containing cell x and y locations, the tissue that the cell belongs to,
whether the cell falls in a hole, and the positivity of the different
cell types.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spatial_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSpatialList.html">CreateSpatialList</a></span><span class="op">(</span>sim_object <span class="op">=</span> <span class="va">bivariate_sim_tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spatial_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x        y Tissue Assignment Cell 1 Assignment Cell 2 Assignment</span></span>
<span><span class="co">#&gt; 1 5.7130558 1.274980          Tissue 1                 0                 0</span></span>
<span><span class="co">#&gt; 2 0.2011937 2.748664          Tissue 2                 0                 0</span></span>
<span><span class="co">#&gt; 3 7.2355739 6.800332          Tissue 2                 0                 0</span></span>
<span><span class="co">#&gt; 4 6.0939363 6.601037          Tissue 2                 0                 0</span></span>
<span><span class="co">#&gt; 5 3.0671935 2.480361          Tissue 1                 0                 0</span></span>
<span><span class="co">#&gt; 6 0.6350984 1.242892          Tissue 1                 0                 0</span></span></code></pre></div>
<p>Alternatively, there is the ability with
<code><a href="../reference/CreateSpatialList.html">CreateSpatialList()</a></code> to export all of the spatial pattern
data as a single data frame using <code>single_df</code> set to
<code>TRUE</code>. This adds an <code>Image Name</code> column that
keeps the spatial pattern data separate, and can split back into a list
later for use with <code><a href="../reference/SummariseSpatial.html">SummariseSpatial()</a></code>, which creates a core
level counts for the different cell types.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_dataframe</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateSpatialList.html">CreateSpatialList</a></span><span class="op">(</span>sim_object <span class="op">=</span> <span class="va">bivariate_sim_tmp</span>, single_df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">single_dataframe</span><span class="op">)</span></span>
<span><span class="co">#&gt;       Image Name         x        y Tissue Assignment Cell 1 Assignment</span></span>
<span><span class="co">#&gt; 1 Spatial Data 1 5.7130558 1.274980          Tissue 1                 0</span></span>
<span><span class="co">#&gt; 2 Spatial Data 1 0.2011937 2.748664          Tissue 2                 0</span></span>
<span><span class="co">#&gt; 3 Spatial Data 1 7.2355739 6.800332          Tissue 2                 0</span></span>
<span><span class="co">#&gt; 4 Spatial Data 1 6.0939363 6.601037          Tissue 2                 0</span></span>
<span><span class="co">#&gt; 5 Spatial Data 1 3.0671935 2.480361          Tissue 1                 0</span></span>
<span><span class="co">#&gt; 6 Spatial Data 1 0.6350984 1.242892          Tissue 1                 0</span></span>
<span><span class="co">#&gt;   Cell 2 Assignment</span></span>
<span><span class="co">#&gt; 1                 0</span></span>
<span><span class="co">#&gt; 2                 0</span></span>
<span><span class="co">#&gt; 3                 0</span></span>
<span><span class="co">#&gt; 4                 0</span></span>
<span><span class="co">#&gt; 5                 0</span></span>
<span><span class="co">#&gt; 6                 0</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/SummariseSpatial.html">SummariseSpatial</a></span><span class="op">(</span>spatial_list <span class="op">=</span> <span class="va">spatial_list</span>, markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cell 1 Assignment"</span>, <span class="st">"Cell 2 Assignment"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 6</span></span></span>
<span><span class="co">#&gt;   `Sample Tag`   `Total Cells` `Cell 1 Assignment` `Cell 2 Assignment`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Spatial Data 1          <span style="text-decoration: underline;">2</span>495                 129                 130</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Spatial Data 2          <span style="text-decoration: underline;">2</span>450                 147                 136</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Spatial Data 3          <span style="text-decoration: underline;">2</span>500                 143                 101</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Spatial Data 4          <span style="text-decoration: underline;">2</span>514                 148                 108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Spatial Data 5          <span style="text-decoration: underline;">2</span>486                 130                  91</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: `% Cell 1 Assignment` &lt;dbl&gt;, `% Cell 2 Assignment` &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The spatial list and summary table can now be used with packages like
<a href="https://github.com/FridleyLab/spatialTIME" class="external-link">spatialTIME</a> to compute spatial statistics on all of the
simulated data frames.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alex Soupir, Christopher Wilson, Julia Wrobel, Oscar Ospina, Brooke Fridley, Fridley Lab.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
